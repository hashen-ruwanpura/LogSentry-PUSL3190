<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - LogSentry</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="{% static 'js/notifications.js' %}"></script>
    <style>
        :root {
            --primary-color: #3f51b5;
            --primary-rgb: 63, 81, 181;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --white: #ffffff;
            --navbar-height: 80px;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: var(--light-color);
        }
        
        body #notification-container {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            z-index: 999999 !important;
            width: 350px !important;
            max-width: 90% !important;
            display: flex !important;
            flex-direction: column !important;
            gap: 10px !important;
            pointer-events: auto !important;
        }

        .navbar {
            background-color: var(--white);
            padding: 0.8rem 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
            height: var(--navbar-height);
        }
        
        .navbar.scrolled {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: 70px;
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .navbar-brand i {
            margin-right: 0.5rem;
            font-size: 1.8rem;
        }
        
        .navbar .nav-item {
            margin: 0 0.2rem;
        }
        
        .navbar .nav-link {
            color: var(--dark-color);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .navbar .nav-link:hover {
            color: var(--primary-color);
            background-color: rgba(var(--primary-rgb), 0.05);
        }
        
        .navbar .nav-link.active {
            color: var(--primary-color);
            background-color: rgba(var(--primary-rgb), 0.1);
        }
        
        .container-main {
            padding-top: calc(var(--navbar-height) + 2rem);
            padding-bottom: 3rem;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .settings-card {
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .settings-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .settings-header i {
            margin-right: 0.75rem;
            font-size: 1.3rem;
        }
        
        .settings-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .form-control {
            border-radius: 5px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 0.75rem;
            font-size: 0.95rem;
        }
        
        .form-control:focus {
            box-shadow: 0 0 0 0.2rem rgba(var(--primary-rgb), 0.25);
            border-color: var(--primary-color);
        }
        
        .form-text {
            color: var(--secondary-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(var(--primary-rgb), 0.3);
        }
        
        .btn-primary:hover {
            background-color: #3a4bb0;
            border-color: #3a4bb0;
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(var(--primary-rgb), 0.35);
        }
        
        .form-switch .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .settings-footer {
            border-top: 1px solid rgba(0,0,0,0.05);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: flex-end;
        }
        
        .settings-separator {
            border-bottom: 1px solid rgba(0,0,0,0.05);
            margin: 1.5rem 0;
        }
        
        .alert {
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .footer {
            background-color: var(--dark-color);
            color: rgba(255,255,255,0.7);
            padding: 3rem 0 2rem;
            text-align: center;
        }
        
        .footer p {
            margin-bottom: 0;
        }
        
        /* Animation for message alerts */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert {
            animation: fadeInDown 0.5s forwards;
        }
        
        .refresh-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .refresh-active {
            background-color: var(--success-color);
            box-shadow: 0 0 5px var(--success-color);
        }
        
        .refresh-inactive {
            background-color: var(--danger-color);
            box-shadow: 0 0 5px var(--danger-color);
        }
        
        /* User dropdown */
        .user-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .user-dropdown .dropdown-menu {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
            margin-top: 0.5rem;
        }
        
        .user-dropdown .dropdown-item i {
            margin-right: 0.5rem;
            opacity: 0.7;
        }
        
        .dropdown-item:hover {
            background-color: rgba(var(--primary-rgb), 0.05);
            color: var(--primary-color);
        }

        .time-display {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        /* Dropzone styling */
        .dropzone {
            position: relative;  /* Ensure relative positioning */
            border: 2px dashed var(--secondary-color);
            border-radius: 5px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
            z-index: 1;  /* Lower z-index */
        }

        .dropzone:hover, .dropzone.dragover {
            border-color: var(--primary-color);
            background-color: rgba(var(--primary-rgb), 0.05);
        }

        .dropzone .dz-message {
            margin: 0;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
            z-index: 2;  /* Only over the dropzone */
            pointer-events: none;  /* Initially disable pointer events */
        }

        .dropzone:hover .file-input {
            pointer-events: auto;  /* Enable pointer events only when hovering over dropzone */
        }

        .file-info {
            background-color: rgba(var(--primary-rgb), 0.1);
            border-radius: 5px;
            padding: 0.5rem 0.75rem;
            transition: all 0.3s ease;
        }

        .file-info:hover {
            background-color: rgba(var(--primary-rgb), 0.15);
        }

        /* Progress bar for file uploads */
        .upload-progress {
            height: 6px;
            margin-top: 0.5rem;
            margin-bottom: 0;
        }

        /* Browse button styling */
        .hidden-file-input {
            display: none;
        }

        /* Animation for drag over */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .dropzone.dragover {
            animation: pulse 1s infinite;
        }

        .file-selected {
            border-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.05);
        }
    </style>
</head>
<body>
    <div id="notification-container"></div>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-shield-alt"></i>LogSentry</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'contact' %}">Contact Us</a>
                    </li>
                    
                    {% if user.is_authenticated %}
                    <li class="nav-item dropdown ms-lg-3">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user"></i>
                            {{ user.username }}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="{% url 'dashboard' %}"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                            <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="fas fa-id-card"></i> My Profile</a></li>
                            <li><a class="dropdown-item active" href="{% url 'settings' %}"><i class="fas fa-cog"></i> Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                        </ul>
                    </li>
                    {% else %}
                    <li class="nav-item ms-lg-3">
                        <a class="btn btn-outline-primary" href="{% url 'login' %}">Sign In</a>
                    </li>
                    <li class="nav-item ms-lg-2">
                        <a class="btn btn-primary" href="{% url 'signup' %}">Sign Up</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-main">
        <h1 class="mb-4"><i class="fas fa-cog me-2"></i>Settings</h1>
        
        {% if success_message %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i> {{ success_message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}
        
        {% if error_message %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i> {{ error_message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}
        
        <div class="row">
            <div class="col-lg-3 mb-4">
                <div class="list-group settings-nav">
                    <a href="#profile-section" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                        <i class="fas fa-user me-2"></i> Profile Settings
                    </a>
                    <a href="#security-section" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="fas fa-lock me-2"></i> Security
                    </a>
                    <a href="#notification-section" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="fas fa-bell me-2"></i> Notifications
                    </a>
                    <a href="#log-section" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="fas fa-file-alt me-2"></i> Log Configuration
                    </a>
                    <a href="#realtime-section" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="fas fa-sync me-2"></i> Real-time Analysis
                    </a>
                </div>
            </div>
            
            <div class="col-lg-9">
                <div class="tab-content">
                    <!-- Profile Settings -->
                    <div class="tab-pane fade show active" id="profile-section">
                        <div class="settings-card">
                            <div class="settings-header">
                                <i class="fas fa-user"></i>
                                <h5 class="mb-0">Profile Settings</h5>
                            </div>
                            <div class="settings-body">
                                <form method="post" action="{% url 'update_profile' %}">
                                    {% csrf_token %}
                                    <div class="form-group mb-4">
                                        <label for="first_name">First Name</label>
                                        <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.first_name }}" required>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="last_name">Last Name</label>
                                        <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user.last_name }}" required>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="email">Email</label>
                                        <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Profile</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Settings -->
                    <div class="tab-pane fade" id="security-section">
                        <div class="settings-card">
                            <div class="settings-header">
                                <i class="fas fa-lock"></i>
                                <h5 class="mb-0">Security Settings</h5>
                            </div>
                            <div class="settings-body">
                                <form method="post" action="{% url 'change_password' %}">
                                    {% csrf_token %}
                                    <div class="form-group mb-4">
                                        <label for="current_password">Current Password</label>
                                        <input type="password" class="form-control" id="current_password" name="current_password" required>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="new_password">New Password</label>
                                        <input type="password" class="form-control" id="new_password" name="new_password" required>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="confirm_password">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Change Password</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notification Settings -->
                    <div class="tab-pane fade" id="notification-section">
                        <div class="settings-card">
                            <div class="settings-header">
                                <i class="fas fa-bell"></i>
                                <h5 class="mb-0">Notification Settings</h5>
                            </div>
                            <div class="settings-body">
                                <form method="post" action="{% url 'save_notification_settings' %}">
                                    {% csrf_token %}
                                    <div class="form-group mb-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="email_alerts" name="email_alerts" 
                                                  {% if notification_settings.email_alerts %}checked{% endif %}>
                                            <label class="form-check-label" for="email_alerts">Email Notifications</label>
                                        </div>
                                    </div>
                                    <div class="form-group mb-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="sms_alerts" name="sms_alerts" 
                                                  {% if notification_settings.sms_alerts %}checked{% endif %}>
                                            <label class="form-check-label" for="sms_alerts">SMS Notifications</label>
                                        </div>
                                    </div>
                                    <div class="form-group mb-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="slack_alerts" name="slack_alerts" 
                                                  {% if notification_settings.slack_alerts %}checked{% endif %}>
                                            <label class="form-check-label" for="slack_alerts">Slack Notifications</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Log Configuration Settings -->
                    <div class="tab-pane fade" id="log-section">
                        <div class="settings-card">
                            <div class="settings-header">
                                <i class="fas fa-file-alt"></i> Log File Configuration
                            </div>
                            <div class="settings-body">
                                <form method="post" action="{% url 'save_log_settings' %}" id="logPathForm" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    
                                    <!-- Hidden field to indicate whether to process logs -->
                                    <input type="hidden" name="process_logs" id="process_logs" value="false">
                                    
                                    <div class="form-group mb-4">
                                        <label class="form-label fw-bold">Apache Log</label>
                                        <div class="mb-3">
                                            <label class="form-label">Path to Apache access log file</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="apache_log_path" name="apache_log_path" 
                                                       value="{{ log_settings.apache_log_path }}" placeholder="Enter the full path to Apache log file">
                                                <button class="btn btn-outline-primary" type="button" id="apache_browse_btn">
                                                    <i class="fas fa-folder-open"></i> Browse
                                                </button>
                                            </div>
                                            <small class="form-text text-muted">Specify the full path to the Apache access log file</small>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label">Or upload Apache log file</label>
                                            <div class="dropzone" id="apache_dropzone">
                                                <div class="dz-message">
                                                    <div class="dz-icon mb-3">
                                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted"></i>
                                                    </div>
                                                    <div class="dz-text">
                                                        <p>Drag & drop Apache log file here</p>
                                                        <p class="text-muted small">or click to select file</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <input type="file" id="apache_log_file" name="apache_log_file" class="d-none" accept=".log,.txt">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group mb-4">
                                        <label class="form-label fw-bold">MySQL Log</label>
                                        <div class="mb-3">
                                            <label class="form-label">Path to MySQL error log file</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="mysql_log_path" name="mysql_log_path"
                                                       value="{{ log_settings.mysql_log_path }}" placeholder="Enter the full path to MySQL log file">
                                                <button class="btn btn-outline-primary" type="button" id="mysql_browse_btn">
                                                    <i class="fas fa-folder-open"></i> Browse
                                                </button>
                                            </div>
                                            <small class="form-text text-muted">Specify the full path to the MySQL error log file</small>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="form-label">Or upload MySQL log file</label>
                                            <div class="dropzone" id="mysql_dropzone">
                                                <div class="dz-message">
                                                    <div class="dz-icon mb-3">
                                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted"></i>
                                                    </div>
                                                    <div class="dz-text">
                                                        <p>Drag & drop MySQL log file here</p>
                                                        <p class="text-muted small">or click to select file</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <input type="file" id="mysql_log_file" name="mysql_log_file" class="d-none" accept=".log,.txt">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group mb-4">
                                        <label class="form-label" for="log_retention">Log Retention Period (days)</label>
                                        <input type="number" class="form-control" id="log_retention" name="log_retention" value="{{ log_settings.log_retention }}" min="1" max="365">
                                        <small class="form-text text-muted">Logs older than this period will be automatically purged</small>
                                    </div>

                                    <div class="form-group mb-4">
                                        <label class="form-label" for="system_log_paths">System Log Paths</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="system_log_paths" name="system_log_paths" 
                                                value="{{ log_settings.system_log_paths|default:'/var/log,C:\\Windows\\Logs' }}" 
                                                placeholder="Enter comma-separated log paths">
                                            <button class="btn btn-outline-secondary" type="button" id="add_system_path_btn">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <small class="form-text text-muted">System log paths to monitor (comma-separated)</small>
                                    </div>

                                    <div class="form-group mb-4">
                                        <label class="form-label" for="custom_log_paths">Custom Log Paths</label>
                                        <div id="custom_paths_container">
                                            {% for path in log_settings.custom_log_paths %}
                                            <div class="input-group mb-2 custom-path-group">
                                                <input type="text" class="form-control custom-path" value="{{ path }}" name="custom_log_paths[]">
                                                <button class="btn btn-outline-danger remove-path-btn" type="button">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            {% empty %}
                                            <div class="input-group mb-2 custom-path-group">
                                                <input type="text" class="form-control custom-path" name="custom_log_paths[]" 
                                                    placeholder="Enter additional log path to monitor">
                                                <button class="btn btn-outline-danger remove-path-btn" type="button">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="add_custom_path_btn">
                                            <i class="fas fa-plus me-1"></i> Add Custom Path
                                        </button>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between">
                                        <button type="button" id="testLogPathBtn" class="btn btn-outline-secondary">
                                            <i class="fas fa-check-circle"></i> Test Log Paths
                                        </button>
                                        
                                        <div>
                                            <button type="button" id="analyzeLogsBtn" class="btn btn-outline-primary me-2">
                                                <i class="fas fa-search"></i> Analyze Logs Now
                                            </button>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save"></i> Save Log Settings
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Real-time Analysis Settings -->
                    <div class="tab-pane fade" id="realtime-section">
                        <div class="settings-card">
                            <div class="settings-header">
                                <i class="fas fa-sync"></i>
                                <h5 class="mb-0">Real-time Analysis Settings</h5>
                            </div>
                            <div class="settings-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span>Real-time Log Analysis Status:</span>
                                    <span>
                                        <span id="refreshStatus" class="refresh-indicator refresh-inactive"></span>
                                        <span id="refreshStatusText">Inactive</span>
                                    </span>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="analysis_interval">Analysis Interval (seconds)</label>
                                    <input type="number" class="form-control" id="analysis_interval" min="10" max="300" value="30">
                                    <div class="form-text">How often to check for new logs (minimum 10 seconds)</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="logs_per_analysis">Logs to Analyze</label>
                                    <input type="number" class="form-control" id="logs_per_analysis" min="10" max="500" value="50">
                                    <div class="form-text">Number of most recent log entries to analyze each interval</div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="enable_realtime" checked>
                                        <label class="form-check-label" for="enable_realtime">Enable Real-time Analysis</label>
                                    </div>
                                    <div class="form-text">Automatically analyze logs at regular intervals</div>
                                </div>
                                
                                <div class="time-display mt-3 text-center">
                                    Next analysis in <span id="countdown">30</span> seconds - Last run: <span id="lastRunTime">Never</span>
                                </div>
                                
                                <div class="settings-footer">
                                    <button type="button" id="runAnalysisBtn" class="btn btn-outline-secondary me-2">Run Analysis Now</button>
                                    <button type="button" id="saveAnalysisBtn" class="btn btn-primary">Save Analysis Settings</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 LogSentry | Securing your servers 24/7</p>
        </div>
    </footer>

    <!-- Bootstrap and other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize settings
            loadSettings();
            
            // Handle tab navigation via URL hash
            const tabLinks = document.querySelectorAll('.settings-nav a');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            if (window.location.hash) {
                const targetTab = document.querySelector(`.settings-nav a[href="${window.location.hash}"]`);
                if (targetTab) {
                    tabLinks.forEach(link => link.classList.remove('active'));
                    tabPanes.forEach(pane => pane.classList.remove('show', 'active'));
                    
                    targetTab.classList.add('active');
                    document.querySelector(window.location.hash).classList.add('show', 'active');
                }
            }
            
            // Test log paths button
            document.getElementById('testLogPathBtn').addEventListener('click', testLogPaths);
            
            // Real-time analysis settings
            const enableRealtimeSwitch = document.getElementById('enable_realtime');
            const analysisIntervalInput = document.getElementById('analysis_interval');
            const logsPerAnalysisInput = document.getElementById('logs_per_analysis');
            
            document.getElementById('saveAnalysisBtn').addEventListener('click', function() {
                const analysisInterval = parseInt(analysisIntervalInput.value);
                const logsPerAnalysis = parseInt(logsPerAnalysisInput.value);
                const enableRealtime = enableRealtimeSwitch.checked;
                
                saveAnalysisSettings(analysisInterval, logsPerAnalysis, enableRealtime);
            });
            
            document.getElementById('runAnalysisBtn').addEventListener('click', runManualAnalysis);
            
            // Initialize real-time analysis if enabled
            setupRealtimeAnalysis();

            // Set up file upload and drag & drop functionality
            setupFileUpload('apache');
            setupFileUpload('mysql');

            // Connect browse buttons to file inputs
            document.getElementById('apache_browse_btn').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('apache_log_file').click();
            });

            document.getElementById('mysql_browse_btn').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('mysql_log_file').click();
            });

            // Function to set up file upload for a given log type
            function setupFileUpload(logType) {
                const dropzone = document.getElementById(`${logType}_dropzone`);
                const fileInput = document.getElementById(`${logType}_log_file`);
                const pathInput = document.getElementById(`${logType}_log_path`);
                
                if (!dropzone || !fileInput || !pathInput) {
                    console.error(`Missing elements for ${logType} file upload setup`);
                    return;
                }
                
                // Handle file selection through input
                fileInput.addEventListener('change', function(e) {
                    if (this.files.length > 0) {
                        const file = this.files[0];
                        
                        // Update the path input with file name
                        // For security reasons browsers don't provide the full file path
                        // We'll use a placeholder path plus the filename
                        pathInput.value = file.name;
                        
                        // Add visual feedback
                        dropzone.classList.add('file-selected');
                        dropzone.innerHTML = `
                            <div class="selected-file p-2">
                                <i class="fas fa-file-alt me-2"></i>
                                <strong>${file.name}</strong> (${formatFileSize(file.size)})
                                <button type="button" class="btn-close ms-2" aria-label="Remove file"></button>
                            </div>
                        `;
                        
                        // Handle remove button
                        dropzone.querySelector('.btn-close').addEventListener('click', function(evt) {
                            evt.preventDefault();
                            evt.stopPropagation();
                            
                            // Reset file input and dropzone
                            fileInput.value = '';
                            dropzone.classList.remove('file-selected');
                            dropzone.innerHTML = `
                                <div class="dz-message">
                                    <div class="dz-icon mb-3">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted"></i>
                                    </div>
                                    <div class="dz-text">
                                        <p>Drag & drop ${logType} log file here</p>
                                        <p class="text-muted small">or click to select file</p>
                                    </div>
                                </div>
                            `;
                        });
                    }
                });
                
                // Set up drag and drop functionality
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }, false);
                });
                
                // Visual feedback for drag events
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropzone.addEventListener(eventName, function() {
                        this.classList.add('dragover');
                    }, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, function() {
                        this.classList.remove('dragover');
                    }, false);
                });
                
                // Handle file drop
                dropzone.addEventListener('drop', function(e) {
                    const files = e.dataTransfer.files;
                    if (files.length) {
                        // Update the file input
                        fileInput.files = files;
                        
                        // Trigger change event to process the file
                        const event = new Event('change', { bubbles: true });
                        fileInput.dispatchEvent(event);
                    }
                });
                
                // Make dropzone clickable
                dropzone.addEventListener('click', function() {
                    fileInput.click();
                });
                
                // Helper function to format file size
                function formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }
            }
        });

        // Fix the form submission to handle file uploads properly
        document.getElementById('logPathForm').addEventListener('submit', function(e) {
            if (!validateLogForm()) {
                e.preventDefault();
                return false;
            }
            
            // If there are file inputs with no files selected but with UI showing files,
            // clear them to avoid ERR_UPLOAD_FILE_CHANGED errors
            const apacheFileInput = document.getElementById('apache_log_file');
            const mysqlFileInput = document.getElementById('mysql_log_file');
            const apacheFileInfo = document.getElementById('apache_file_info');
            const mysqlFileInfo = document.getElementById('mysql_file_info');
            
            if (apacheFileInput.files.length === 0 && !apacheFileInfo.classList.contains('d-none')) {
                // Remove the file visualization as no file is actually selected
                apacheFileInfo.classList.add('d-none');
                // Also remove any security notices that might have been added
                if (apacheFileInfo.nextElementSibling && apacheFileInfo.nextElementSibling.classList.contains('alert-info')) {
                    apacheFileInfo.nextElementSibling.remove();
                }
            }
            
            if (mysqlFileInput.files.length === 0 && !mysqlFileInfo.classList.contains('d-none')) {
                // Remove the file visualization as no file is actually selected
                mysqlFileInfo.classList.add('d-none');
                // Also remove any security notices that might have been added
                if (mysqlFileInfo.nextElementSibling && mysqlFileInfo.nextElementSibling.classList.contains('alert-info')) {
                    mysqlFileInfo.nextElementSibling.remove();
                }
            }
            
            // Show loading state
            const submitButton = this.querySelector('[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
            submitButton.disabled = true;
            
            return true;
        });

        function validateLogForm() {
            const apachePath = document.getElementById('apache_log_path').value.trim();
            const mysqlPath = document.getElementById('mysql_log_path').value.trim();
            
            // Check if at least one path is provided
            if (!apachePath && !mysqlPath) {
                showAlert('warning', 'Please provide at least one log file path.');
                return false;
            }
            
            // Check if provided Apache path exists (only if a path was entered)
            if (apachePath) {
                // Visual feedback for validation
                document.getElementById('apache_log_path').classList.add('is-valid');
            }
            
            // Check if provided MySQL path exists (only if a path was entered)
            if (mysqlPath) {
                // Visual feedback for validation
                document.getElementById('mysql_log_path').classList.add('is-valid');
            }
            
            return true;
        }

        // Handle "Analyze Logs Now" button
        document.getElementById('analyzeLogsBtn').addEventListener('click', function() {
            // Set the flag to process logs
            document.getElementById('process_logs').value = 'true';
            
            // Validate the form
            if (validateLogForm()) {
                // Submit the form
                document.getElementById('logPathForm').submit();
            }
        });

        // Load saved settings from localStorage or server
        function loadSettings() {
            // Check if we have saved settings in localStorage
            const savedAnalysisSettings = localStorage.getItem('analysisSettings');
            if (savedAnalysisSettings) {
                const settings = JSON.parse(savedAnalysisSettings);
                document.getElementById('analysis_interval').value = settings.interval || 30;
                document.getElementById('logs_per_analysis').value = settings.logsCount || 50;
                document.getElementById('enable_realtime').checked = settings.enabled !== false;
            }
        }
        
        // Test if log paths are accessible
        function testLogPaths() {
            const apachePath = document.getElementById('apache_log_path').value;
            const mysqlPath = document.getElementById('mysql_log_path').value;
            
            // Display loading indicator
            document.getElementById('testLogPathBtn').innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Testing...';
            document.getElementById('testLogPathBtn').disabled = true;
            
            fetch('/api/test-log-paths/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    apache_path: apachePath,
                    mysql_path: mysqlPath
                })
            })
            .then(response => response.json())
            .then(data => {
                // Reset button
                document.getElementById('testLogPathBtn').innerHTML = 'Test Log Paths';
                document.getElementById('testLogPathBtn').disabled = false;
                
                if (data.success) {
                    showAlert('success', 'Log paths are valid and accessible.');
                } else {
                    showAlert('danger', `Error: ${data.error}`);
                }
            })
            .catch(error => {
                // Reset button
                document.getElementById('testLogPathBtn').innerHTML = 'Test Log Paths';
                document.getElementById('testLogPathBtn').disabled = false;
                showAlert('danger', `Failed to test log paths: ${error.message}`);
            });
        }
        
        // Setup real-time analysis
        function setupRealtimeAnalysis() {
            const savedAnalysisSettings = localStorage.getItem('analysisSettings');
            let settings = {
                interval: 30,
                logsCount: 50,
                enabled: true,
                lastRun: null
            };
            
            if (savedAnalysisSettings) {
                settings = { ...settings, ...JSON.parse(savedAnalysisSettings) };
            }
            
            // Update UI with settings
            document.getElementById('analysis_interval').value = settings.interval;
            document.getElementById('logs_per_analysis').value = settings.logsCount;
            document.getElementById('enable_realtime').checked = settings.enabled;
            
            // Update last run time
            if (settings.lastRun) {
                document.getElementById('lastRunTime').textContent = new Date(settings.lastRun).toLocaleTimeString();
            }
            
            // Set initial status
            updateAnalysisStatus(settings.enabled);
            
            // Start countdown if enabled
            if (settings.enabled) {
                startAnalysisCountdown(settings.interval);
            }
            
            // Add event listener to toggle switch
            document.getElementById('enable_realtime').addEventListener('change', function() {
                updateAnalysisStatus(this.checked);
                
                if (this.checked) {
                    const interval = parseInt(document.getElementById('analysis_interval').value);
                    startAnalysisCountdown(interval);
                }
                
                saveAnalysisSettings(
                    parseInt(document.getElementById('analysis_interval').value),
                    parseInt(document.getElementById('logs_per_analysis').value),
                    this.checked
                );
            });
        }
        
        // Update the UI to reflect the real-time analysis status
        function updateAnalysisStatus(enabled) {
            const statusIndicator = document.getElementById('refreshStatus');
            const statusText = document.getElementById('refreshStatusText');
            
            if (enabled) {
                statusIndicator.className = 'refresh-indicator refresh-active';
                statusText.textContent = 'Active';
            } else {
                statusIndicator.className = 'refresh-indicator refresh-inactive';
                statusText.textContent = 'Inactive';
            }
        }
        
        // Save the real-time analysis settings
        function saveAnalysisSettings(interval, logsCount, enabled) {
            // Validate inputs
            interval = Math.max(10, Math.min(300, interval));
            logsCount = Math.max(10, Math.min(500, logsCount));
            
            // Update inputs with validated values
            document.getElementById('analysis_interval').value = interval;
            document.getElementById('logs_per_analysis').value = logsCount;
            
            // Save settings to localStorage
            const settings = {
                interval: interval,
                logsCount: logsCount,
                enabled: enabled,
                lastRun: localStorage.getItem('analysisSettings') ? 
                    JSON.parse(localStorage.getItem('analysisSettings')).lastRun : null
            };
            
            localStorage.setItem('analysisSettings', JSON.stringify(settings));
            
            // Update UI
            updateAnalysisStatus(enabled);
            
            // Restart countdown if enabled
            if (enabled) {
                startAnalysisCountdown(interval);
            }
            
            showAlert('success', 'Real-time analysis settings saved.');
        }
        
        // Start the countdown for the next analysis run
        let countdownInterval;
        function startAnalysisCountdown(seconds) {
            // Clear any existing countdown
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // Update countdown display
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = seconds;
            
            // Start new countdown
            let remaining = seconds;
            countdownInterval = setInterval(function() {
                remaining--;
                countdownElement.textContent = remaining;
                
                if (remaining <= 0) {
                    // Time to run analysis
                    runLogAnalysis();
                    
                    // Restart countdown
                    remaining = seconds;
                    countdownElement.textContent = remaining;
                }
            }, 1000);
        }
        
        // Run the log analysis
        function runLogAnalysis() {
            const settings = JSON.parse(localStorage.getItem('analysisSettings')) || {
                interval: 30,
                logsCount: 50,
                enabled: true
            };
            
            // Only run if enabled
            if (!settings.enabled) return;
            
            fetch('/api/analyze-logs/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    logs_count: settings.logsCount
                })
            })
            .then(response => response.json())
            .then(data => {
                // Update last run time
                const now = new Date();
                document.getElementById('lastRunTime').textContent = now.toLocaleTimeString();
                
                // Update settings with latest run time
                settings.lastRun = now.toISOString();
                localStorage.setItem('analysisSettings', JSON.stringify(settings));
                
                // Show notification if there are threats
                if (data.threats_found > 0) {
                    showAlert('warning', `Found ${data.threats_found} potential security threat(s) in logs.`);
                }
            })
            .catch(error => {
                console.error('Log analysis failed:', error);
            });
        }
        
        // Run analysis manually
        function runManualAnalysis() {
            const logsCount = parseInt(document.getElementById('logs_per_analysis').value);
            
            // Update button to show loading state
            const button = document.getElementById('runAnalysisBtn');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';
            button.disabled = true;
            
            fetch('/api/analyze-logs/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: JSON.stringify({
                    logs_count: logsCount
                })
            })
            .then(response => response.json())
            .then(data => {
                // Update last run time
                const now = new Date();
                document.getElementById('lastRunTime').textContent = now.toLocaleTimeString();
                
                // Update settings with latest run time
                const settings = JSON.parse(localStorage.getItem('analysisSettings')) || {};
                settings.lastRun = now.toISOString();
                localStorage.setItem('analysisSettings', JSON.stringify(settings));
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Show results
                if (data.threats_found > 0) {
                    showAlert('warning', `Found ${data.threats_found} potential security threat(s) in ${data.logs_analyzed} logs analyzed.`);
                } else {
                    showAlert('success', `No security threats found. Analyzed ${data.logs_analyzed} logs.`);
                }
            })
            .catch(error => {
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                showAlert('danger', `Analysis failed: ${error.message}`);
            });
        }
        
        // Show alert message
        function showAlert(type, message) {
            let alertsContainer = document.getElementById('alertsContainer');
            
            if (!alertsContainer) {
                alertsContainer = document.createElement('div');
                alertsContainer.style.position = 'fixed';
                alertsContainer.style.top = '20px';
                alertsContainer.style.right = '20px';
                alertsContainer.style.zIndex = '9999';
                alertsContainer.style.maxWidth = '400px';
                alertsContainer.id = 'alertsContainer';
                document.body.appendChild(alertsContainer);
            }
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.role = 'alert';
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'danger') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            alert.innerHTML = `
                <i class="fas fa-${icon} me-2"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            alertsContainer.appendChild(alert);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => {
                    alert.remove();
                }, 150);
            }, 5000);
        }

        // Direct fix for security alert banner
        function fixBanner() {
            // Find security alert by its text content
            const securityAlerts = Array.from(document.querySelectorAll('.alert'))
                .filter(el => el.textContent.includes('Found') && 
                             el.textContent.includes('potential security threat') && 
                             el.textContent.includes('in logs'));
            
            securityAlerts.forEach(alert => {
                // Skip if already enhanced
                if (alert.hasAttribute('data-fixed')) return;
                alert.setAttribute('data-fixed', 'true');
                
                // Force inline styles with !important
                alert.style.cssText = `
                    position: relative !important;
                    cursor: pointer !important;
                    padding-right: 35px !important;
                `;
                
                // Make alert clickable
                alert.addEventListener('click', function(e) {
                    // Only navigate if not clicking the close button
                    if (!e.target.classList.contains('btn-close') && !e.target.classList.contains('close') && e.target.tagName !== 'BUTTON') {
                        window.location.href = '/events/?severity=all&status=new';
                    }
                });
                
                // Fix the close button
                const closeBtn = alert.querySelector('.btn-close, .close, [data-bs-dismiss="alert"], [data-dismiss="alert"]');
                if (closeBtn) {
                    // Remove original close button
                    closeBtn.remove();
                    
                    // Create new close button with forced inline styles
                    const newBtn = document.createElement('button');
                    newBtn.innerHTML = '&times;';
                    newBtn.setAttribute('aria-label', 'Close');
                    newBtn.style.cssText = `
                        position: absolute !important;
                        top: 8px !important;
                        right: 10px !important;
                        background: transparent !important;
                        border: none !important;
                        font-size: 14px !important;
                        font-weight: normal !important;
                        line-height: 1 !important;
                        padding: 0 !important;
                        margin: 0 !important;
                        width: 16px !important;
                        height: 16px !important;
                        text-align: center !important;
                        cursor: pointer !important;
                        z-index: 100 !important;
                    `;
                    
                    // Add click handler
                    newBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        alert.style.display = 'none';
                    });
                    
                    alert.appendChild(newBtn);
                }
            });
        }

        // Create MutationObserver to detect when new alerts are added
        const alertObserver = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                    // Check if any added nodes match our alert criteria
                    for (let i = 0; i < mutation.addedNodes.length; i++) {
                        const node = mutation.addedNodes[i];
                        if (node.nodeType === Node.ELEMENT_NODE) {
                            // Run fixBanner if element was added to the DOM
                            fixBanner();
                        }
                    }
                }
            });
        });

        // Start observing the document body for DOM changes
        alertObserver.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Fix footer spacing and make sure it sits properly at the bottom of the page
        document.addEventListener('DOMContentLoaded', function() {
            // Fix footer styling
            const footer = document.querySelector('.footer');
            if (footer) {
                footer.style.marginTop = '30px';
                footer.style.position = 'relative';
                footer.style.width = '100%';
                
                // Ensure page content has enough height to push footer down
                const containerMain = document.querySelector('.container-main');
                if (containerMain) {
                    containerMain.style.minHeight = 'calc(100vh - 180px)';
                }
            }
            
            // Make sure fixBanner runs immediately and periodically
            fixBanner();
            setInterval(fixBanner, 1000);
        });

        // Also ensure the banner fix runs when page loads
        if (document.readyState === 'interactive' || document.readyState === 'complete') {
            const footer = document.querySelector('.footer');
            if (footer) {
                footer.style.marginTop = '30px';
            }
            fixBanner();
        }

        // Custom log paths management
        document.getElementById('add_custom_path_btn').addEventListener('click', function() {
            const container = document.getElementById('custom_paths_container');
            const newGroup = document.createElement('div');
            newGroup.className = 'input-group mb-2 custom-path-group';
            newGroup.innerHTML = `
                <input type="text" class="form-control custom-path" name="custom_log_paths[]" 
                    placeholder="Enter additional log path to monitor">
                <button class="btn btn-outline-danger remove-path-btn" type="button">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(newGroup);
            
            // Add event listener to the new remove button
            newGroup.querySelector('.remove-path-btn').addEventListener('click', removePath);
        });

        // Add event listeners to existing remove buttons
        document.querySelectorAll('.remove-path-btn').forEach(btn => {
            btn.addEventListener('click', removePath);
        });

        function removePath(e) {
            // Only remove if there's more than one path
            const pathGroups = document.querySelectorAll('.custom-path-group');
            if (pathGroups.length > 1) {
                e.target.closest('.custom-path-group').remove();
            } else {
                // If it's the last one, just clear the input
                e.target.closest('.custom-path-group').querySelector('input').value = '';
            }
        }
    </script>

    <!-- Add this at the bottom of settings.html before </body> -->
    <script>
    // Display flash messages/alerts
    document.addEventListener('DOMContentLoaded', function() {
        // Show success message if present
        const successMessage = '{{ success_message }}';
        if (successMessage && successMessage !== 'None') {
            showAlert('success', successMessage);
        }
        
        // Show error message if present
        const errorMessage = '{{ error_message }}';
        if (errorMessage && errorMessage !== 'None') {
            showAlert('danger', errorMessage);
        }
        
        // Form validation
        const passwordForm = document.querySelector('form[action*="change-password"]');
        if (passwordForm) {
            passwordForm.addEventListener('submit', function(event) {
                const newPassword = document.getElementById('new_password').value;
                const confirmPassword = document.getElementById('confirm_password').value;
                
                if (newPassword !== confirmPassword) {
                    event.preventDefault();
                    showAlert('danger', 'Passwords do not match');
                }
            });
        }
        
        // File path validation
        const logPathForm = document.getElementById('logPathForm');
        if (logPathForm) {
            logPathForm.addEventListener('submit', function() {
                const apachePath = document.getElementById('apache_log_path').value;
                const mysqlPath = document.getElementById('mysql_log_path').value;
                
                if (!apachePath && !mysqlPath) {
                    showAlert('warning', 'At least one log path should be provided');
                }
            });
        }
    });

    // Helper function to show alerts
    function showAlert(type, message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.role = 'alert';
        
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        // Find a good place to insert the alert
        const container = document.querySelector('.settings-card') || document.querySelector('.container');
        if (container) {
            container.insertBefore(alertDiv, container.firstChild);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => alertDiv.remove(), 150);
            }, 5000);
        }
    }
    </script>
</body>
</html>